---
document: è–ªé…¬ç®¡ç†ç³»ç»Ÿ Â· å¼€å‘ç­–ç•¥æ–‡æ¡£ï¼ˆCLAUDE.mdï¼‰
version: 3.5
date: 2026-02-14
companion: China/Devolop files SOP/ï¼ˆæ¨¡å—åŒ– PRD æ–‡ä»¶å¤¹ï¼‰
purpose: AI å¼€å‘è¡Œä¸ºå‡†åˆ™ + æŠ€æœ¯æ‰§è¡Œæ‰‹å†Œ
change_log:
  - v3.5: P1ï¼ˆSQLite/Data/Settings/Employee/Import-Exportï¼‰æ”¶å£å®Œæˆï¼Œè¡¥å……é˜¶æ®µçŠ¶æ€ä¸ P2 å¯åŠ¨æ¸…å•
  - v3.4: è¡¥å…… better-sqlite3 ABI è‡ªåŠ¨åˆ‡æ¢çº¦æŸï¼ˆtest/node ä¸ test:e2e/electronï¼‰ã€preload CJS ä¸ Vite base="./" å·¥ç¨‹çº¦æŸï¼Œå¹¶åŠ å…¥éªŒæ”¶å£å¾„
  - v3.3: è¡¥å…… SQLite åŠŸèƒ½æµ‹è¯•éš”ç¦»è§„èŒƒï¼ˆAPP_ENV / TEST_DB_PATH / resetDatabase å®‰å…¨é—¸ï¼‰ä¸ P1 æµ‹è¯•æ²™ç›’åŸºå»ºä»»åŠ¡
  - v3.2: æ•°æ®æŒä¹…åŒ–å‡çº§ä¸º SQLite + better-sqlite3ï¼ˆä¸šåŠ¡ä¸»æ•°æ®ï¼‰+ electron-storeï¼ˆè½»é…ç½®ï¼‰ï¼Œè¡¥å……åˆ†é˜¶æ®µè¿ç§»ä¸å›æ»šå¼€å…³
  - v3.1: æµ‹è¯•æ²»ç†å‡çº§ä¸ºå•ä¸€æƒå¨æºï¼Œæ–°å¢æµ‹è¯•äº§å‡ºåˆ†çº§ï¼ˆæ—¥å¸¸è¿­ä»£/é‡Œç¨‹ç¢‘ï¼‰ã€ä¸šåŠ¡åœºæ™¯ä¼˜å…ˆå‘½åè§„åˆ™ã€å®¢è§‚è¯æ®é“¾ï¼ˆraw JSON + case map + XLSXï¼‰
  - v3.0: UI ç»„ä»¶åº“ç”± Ant Design æ›¿æ¢ä¸º shadcn/ui + Tailwind CSSï¼Œæ–°å¢è®¾è®¡ç³»ç»Ÿæ˜ å°„ã€ç»„ä»¶å¯¹ç…§è¡¨ï¼ŒæŠ€æœ¯æ ˆæ–°å¢ TanStack Table / react-hook-form / zod / lucide-react
  - v2.0: å‡çº§ä¸º CLAUDE.md æ ¼å¼ï¼Œæ–°å¢ AI è¡Œä¸ºçº¢çº¿ã€æµ‹è¯•ç­–ç•¥ã€PRD å¼ºåˆ¶éµå¾ªæœºåˆ¶
  - v1.1: ç§»é™¤ä¸ PRD é‡å¤å†…å®¹ï¼Œå¯¹é½æ¨¡å—åŒ– PRD æ–‡ä»¶å¼•ç”¨
  - v1.0: åˆå§‹ç‰ˆæœ¬
---

# è–ªé…¬ç®¡ç†ç³»ç»Ÿ Â· å¼€å‘ç­–ç•¥æ–‡æ¡£

> **æŠ€æœ¯æ ˆï¼š** Electron + React 18 + TypeScript + Vite + shadcn/ui + Tailwind CSS + Zustand\
> **æ‰“åŒ…ç›®æ ‡ï¼š** Mac (.dmg) + Windows (.exe)\
> **äº§å“éœ€æ±‚ï¼š** è§ `China/Devolop files SOP/00-INDEX.md`ï¼ˆæ¨¡å—åŒ– PRD ä¸»ç´¢å¼•ï¼‰\
> **æœ¬æ–‡æ¡£æ€§è´¨ï¼š** ç­‰åŒäº `CLAUDE.md`ï¼Œæ˜¯ AI è¾…åŠ©å¼€å‘çš„è¡Œä¸ºå‡†åˆ™å’Œæ‰§è¡Œæ‰‹å†Œ

---

## â›” ä¸€ã€AI è¡Œä¸ºçº¢çº¿ï¼ˆå¿…é¡»éµå®ˆï¼‰

æœ¬ç« èŠ‚å®šä¹‰ AI åœ¨å¼€å‘è¿‡ç¨‹ä¸­**ä¸å¯è¿å**çš„è¡Œä¸ºè¾¹ç•Œã€‚

### 1.1 ä¸å¯è‡ªå¯¼è‡ªæ¼”

```
âŒ ç¦æ­¢è¡Œä¸ºï¼š
- ä¸ç¡®å®šæŸä¸ª API ç”¨æ³•æ—¶ï¼Œå‡­è®°å¿†ç¼–é€ ä»£ç 
- ä¸ç¡®å®šæŸä¸ªåº“çš„é…ç½®æ–¹å¼æ—¶ï¼Œ"çŒœæµ‹"ä¸€ä¸ªçœ‹èµ·æ¥åˆç†çš„å†™æ³•
- é‡åˆ°æŠ¥é”™æ—¶ï¼ŒæœªæŸ¥è¯å°±è¿ç»­å°è¯•å¤šç§"å¯èƒ½çš„ä¿®å¤"
- ç¼–é€ ä¸å­˜åœ¨çš„ç»„ä»¶å±æ€§ã€å‡½æ•°å‚æ•°ã€é…ç½®é¡¹

âœ… æ­£ç¡®è¡Œä¸ºï¼š
- æ‰¿è®¤"æˆ‘ä¸ç¡®å®šè¿™ä¸ª API çš„å…·ä½“ç”¨æ³•"
- é€šè¿‡ MCP è”ç½‘æœç´¢å®˜æ–¹æ–‡æ¡£
- åŸºäºå®˜æ–¹æ–‡æ¡£çš„å®é™…ç¤ºä¾‹ç¼–å†™ä»£ç 
```

### 1.2 å¿…é¡»è”ç½‘æŸ¥è¯çš„åœºæ™¯

ä»¥ä¸‹åœºæ™¯**å¿…é¡»**é€šè¿‡ MCP å·¥å…·è”ç½‘æœç´¢å®˜æ–¹æ–‡æ¡£ï¼Œä¸å¯å‡­è®°å¿†ä½œç­”ï¼š

| åœºæ™¯ | æœç´¢ç›®æ ‡ |
|------|----------|
| Electron API è°ƒç”¨ï¼ˆIPCã€çª—å£ç®¡ç†ã€èœå•ç­‰ï¼‰ | electronjs.org å®˜æ–¹æ–‡æ¡£ |
| shadcn/ui ç»„ä»¶ç”¨æ³•æˆ–è‡ªå®šä¹‰ä¸»é¢˜ | ui.shadcn.com å®˜æ–¹æ–‡æ¡£ |
| Tailwind CSS å·¥å…·ç±»æˆ–é…ç½® | tailwindcss.com å®˜æ–¹æ–‡æ¡£ |
| TanStack Table é…ç½®å’Œ API | tanstack.com/table å®˜æ–¹æ–‡æ¡£ |
| react-hook-form è¡¨å•éªŒè¯ | react-hook-form.com å®˜æ–¹æ–‡æ¡£ |
| SQLite / better-sqlite3ï¼ˆå»ºè¡¨ã€äº‹åŠ¡ã€WALã€ç´¢å¼•ï¼‰ | sqlite.org + better-sqlite3 GitHub æ–‡æ¡£ |
| electron-storeï¼ˆè½»é…ç½®å±‚ï¼‰ | npm æ–‡æ¡£ / GitHub README |
| electron-builder æ‰“åŒ…é…ç½®ï¼ˆdmg / exeï¼‰ | electron.build å®˜æ–¹æ–‡æ¡£ |
| i18next / react-i18next é…ç½® | i18next.com å®˜æ–¹æ–‡æ¡£ |
| jsPDF / html2canvas API | å¯¹åº” npm / GitHub æ–‡æ¡£ |
| xlsx (SheetJS) å¯¼å…¥å¯¼å‡º API | docs.sheetjs.com |
| Zustand persist ä¸­é—´ä»¶ | zustand GitHub æ–‡æ¡£ |
| decimal.js API | mikemcl.github.io/decimal.js |
| Vite + Electron æ•´åˆæ–¹æ¡ˆ | å¯¹åº”æ¨¡æ¿/æ’ä»¶æ–‡æ¡£ |

### 1.3 è”ç½‘å¤±è´¥æ—¶çš„å¤„ç†

```
å¦‚æœ MCP è”ç½‘æœç´¢å¤±è´¥æˆ–æ— æ³•è®¿é—®ç›®æ ‡æ–‡æ¡£ï¼š
  1. ç«‹å³åœæ­¢å½“å‰ä»»åŠ¡
  2. æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·ï¼š"è”ç½‘æœç´¢å¤±è´¥ï¼Œæ— æ³•æŸ¥è¯ [å…·ä½“å†…å®¹]ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æ‰‹åŠ¨æä¾›æ–‡æ¡£"
  3. ä¸å¯é€€è€Œæ±‚å…¶æ¬¡åœ°"å‡­è®°å¿†å†™ä¸€ç‰ˆè¯•è¯•"
  4. ç­‰å¾…ç”¨æˆ·æä¾›æ–‡æ¡£æˆ–ç¡®è®¤åå†ç»§ç»­
```

### 1.4 PRD å¼ºåˆ¶éµå¾ª

```
æ‰€æœ‰åŠŸèƒ½å®ç°å¿…é¡»ä¸¥æ ¼å¯¹ç…§ PRD æ–‡ä»¶ï¼š
  1. å¼€å§‹ä»»ä½•æ¨¡å—å¼€å‘å‰ï¼Œå¿…é¡»å…ˆè¯»å–å¯¹åº”çš„ PRD æ–‡ä»¶
  2. å­—æ®µåã€ç±»å‹ã€è®¡ç®—å…¬å¼å¿…é¡»ä¸ PRD 01-data-model.md å®Œå…¨ä¸€è‡´
  3. UI ç»“æ„å¿…é¡»ä¸ PRD ä¸­æè¿°çš„é¡µé¢å¸ƒå±€ä¸€è‡´
  4. ä¸å¯"ä¼˜åŒ–"æˆ–"æ”¹è¿›" PRD ä¸­æ˜ç¡®å®šä¹‰çš„ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æœ‰å»ºè®®ï¼Œå…ˆæå‡ºå†ç­‰ç¡®è®¤ï¼‰
  5. æ¯å®Œæˆä¸€ä¸ªåŠŸèƒ½ï¼Œå¯¹ç…§ PRD å¯¹åº”ç« èŠ‚é€é¡¹è‡ªæ£€
```

### 1.5 ä»£ç è´¨é‡çº¢çº¿

```
- å•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ 200 è¡Œï¼ˆè¶…å‡ºå¿…é¡»æ‹†åˆ†ï¼‰
- æ‰€æœ‰ç”¨æˆ·å¯è§æ–‡å­—å¿…é¡»èµ° i18nï¼ˆt('key')ï¼‰ï¼Œç¦æ­¢ç¡¬ç¼–ç ä¸­æ–‡
- é‡‘é¢è®¡ç®—å¿…é¡»ä½¿ç”¨ decimal.jsï¼Œç¦æ­¢åŸç”Ÿæµ®ç‚¹è¿ç®—
- TypeScript strict æ¨¡å¼ï¼Œç¦æ­¢ any ç±»å‹ï¼ˆæå°‘æ•°å¿…è¦åœºæ™¯éœ€æ³¨é‡Šè¯´æ˜ç†ç”±ï¼‰
- æ¯ä¸ª service å‡½æ•°å¿…é¡»æ˜¯çº¯å‡½æ•°ï¼ˆé›¶å‰¯ä½œç”¨ï¼Œå¯ç‹¬ç«‹æµ‹è¯•ï¼‰
- ç»„ä»¶ props å¿…é¡»æœ‰æ˜ç¡®çš„ TypeScript æ¥å£å®šä¹‰
```

---

## äºŒã€æŠ€æœ¯é€‰å‹

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬è¦æ±‚ | æ–‡æ¡£åœ°å€ï¼ˆè”ç½‘æŸ¥è¯ç”¨ï¼‰ |
|------|----------|:-------:|----------------------|
| æ¡Œé¢å£³ | Electron | 33+ | electronjs.org |
| å‰ç«¯æ¡†æ¶ | React + TypeScript | 18.x | react.dev |
| æ„å»ºå·¥å…· | Vite | 6.x | vite.dev |
| UI ç»„ä»¶åº“ | shadcn/ui | latest | ui.shadcn.com |
| CSS æ¡†æ¶ | Tailwind CSS | 4.x | tailwindcss.com |
| æ•°æ®è¡¨æ ¼ | TanStack Table | 8.x | tanstack.com/table |
| è¡¨å•éªŒè¯ | react-hook-form + zod | 7.x / 3.x | react-hook-form.com |
| çŠ¶æ€ç®¡ç† | Zustand | 5.x | github.com/pmndrs/zustand |
| å›½é™…åŒ– | i18next + react-i18next | 24.x | i18next.com |
| æ•°æ®æŒä¹…åŒ–ï¼ˆä¸»æ•°æ®ï¼‰ | SQLite + better-sqlite3 | latest stable | sqlite.org / github.com/WiseLibs/better-sqlite3 |
| è½»é…ç½®æŒä¹…åŒ– | electron-store | 11.x | github.com/sindresorhus/electron-store |
| é‡‘é¢è®¡ç®— | decimal.js | 10.x | mikemcl.github.io/decimal.js |
| PDF å¯¼å‡º | jsPDF + html2canvas | â€” | â€” |
| Excel | xlsx (SheetJS) | â€” | docs.sheetjs.com |
| å›¾æ ‡åº“ | lucide-react | latest | lucide.dev |
| æ‰“åŒ…å·¥å…· | electron-builder | 25.x | electron.build |
| å•å…ƒæµ‹è¯• | Vitest | 3.x | vitest.dev |
| ç»„ä»¶æµ‹è¯• | React Testing Library | 16.x | testing-library.com |
| E2E æµ‹è¯• | Playwright | 1.5x | playwright.dev |

> âš ï¸ ç‰ˆæœ¬å·ä»…ä¸ºå‚è€ƒåŒºé—´ã€‚å®é™…å®‰è£…æ—¶ä»¥ `npm info <package> version` è¿”å›çš„æœ€æ–°ç¨³å®šç‰ˆä¸ºå‡†ï¼Œå¦‚æœ‰å¤§ç‰ˆæœ¬å·®å¼‚éœ€è”ç½‘ç¡®è®¤ breaking changesã€‚

### 2.1 shadcn/ui è®¾è®¡ç³»ç»Ÿ Ã— åŸç³»ç»Ÿé…è‰²æ˜ å°„

åŸ HTML Demo é‡‡ç”¨æš–è‰²è°ƒé«˜çº§æ„Ÿé…è‰²æ–¹æ¡ˆï¼Œå®Œæ•´æ˜ å°„åˆ° shadcn/ui CSS å˜é‡ä½“ç³»ï¼š

```css
/* src/styles/globals.css */
@import "tailwindcss";

@layer base {
  :root {
    /* â€”â€” åŸç³»ç»Ÿé…è‰² â†’ shadcn/ui å˜é‡æ˜ å°„ â€”â€” */
    --background: 48 33% 96%;           /* #F6F5F1 æš–ç±³ç™½èƒŒæ™¯ */
    --foreground: 60 5% 11%;            /* #1C1C1A è¿‘é»‘è‰²æ–‡å­— */

    --card: 0 0% 100%;                  /* #FFFFFF å¡ç‰‡èƒŒæ™¯ */
    --card-foreground: 60 5% 11%;       /* #1C1C1A */

    --popover: 0 0% 100%;
    --popover-foreground: 60 5% 11%;

    --primary: 155 37% 27%;             /* #2C5F4A æ·±ç»¿ä¸»è‰²è°ƒ */
    --primary-foreground: 48 33% 96%;   /* #F6F5F1 */

    --secondary: 40 12% 91%;            /* #ECEAE5 æµ…ç°èƒŒæ™¯ */
    --secondary-foreground: 60 5% 11%;

    --muted: 42 18% 97%;               /* #FAFAF8 */
    --muted-foreground: 44 7% 40%;     /* #6B6860 æ¬¡è¦æ–‡å­— */

    --accent: 42 18% 97%;              /* #FAFAF8 hover èƒŒæ™¯ */
    --accent-foreground: 60 5% 11%;

    --destructive: 6 51% 47%;          /* #B5453A ç –çº¢è‰²è­¦å‘Š */
    --destructive-foreground: 0 60% 97%; /* #FDF2F1 */

    --border: 40 14% 90%;              /* #E9E7E2 æš–ç°è¾¹æ¡† */
    --input: 40 14% 90%;
    --ring: 155 37% 27%;               /* ç„¦ç‚¹ç¯è·Ÿéšä¸»è‰² */

    --radius: 0.625rem;                /* 10px åœ†è§’ */

    /* â€”â€” æ‰©å±•å˜é‡ï¼ˆé shadcn æ ‡å‡†ï¼Œä¸šåŠ¡ä¸“ç”¨ï¼‰â€”â€” */
    --border-light: 38 17% 94%;        /* #F2F0EC æ›´æµ…çš„åˆ†éš”çº¿ */
    --text-3: 42 5% 61%;               /* #A09D95 è¾…åŠ©æ–‡å­— */
    --text-4: 42 6% 75%;               /* #C5C2BA æœ€æµ…æ–‡å­— */
    --accent-green-light: 150 26% 94%; /* #EDF3F0 ç»¿è‰²æµ…åº• */
  }
}
```

**å­—ä½“è§„èŒƒ**ï¼ˆå»¶ç»­åŸç³»ç»Ÿè®¾è®¡ï¼‰ï¼š

| ç”¨é€” | å­—ä½“ | è¯´æ˜ |
|------|------|------|
| æ­£æ–‡/æ ‡ç­¾ | `'Noto Sans SC', system-ui, sans-serif` | ä¸­è‹±æ–‡æ··æ’ |
| æ•°å­—/é‡‘é¢ | `'DM Mono', monospace` | ç­‰å®½æ•°å­—ï¼Œå¯¹é½æ›´ç¾è§‚ |

åœ¨ `tailwind.config.ts` ä¸­æ‰©å±•ï¼š

```typescript
// tailwind.config.ts
export default {
  theme: {
    extend: {
      fontFamily: {
        sans: ['Noto Sans SC', 'system-ui', 'sans-serif'],
        mono: ['DM Mono', 'monospace'],
      },
    },
  },
}
```

### 2.2 shadcn/ui ç»„ä»¶ Ã— åŸç³»ç»Ÿ UI å…ƒç´ å¯¹ç…§

| åŸ HTML Demo å…ƒç´  | shadcn/ui ç»„ä»¶ | è¡¥å……è¯´æ˜ |
|-------------------|---------------|----------|
| `.nav-tabs` å¯¼èˆªæ ‡ç­¾ | `<Tabs>` | ç”¨ Tailwind è‡ªå®šä¹‰åœ†è§’ pill æ ·å¼ |
| `.sub-tabs` å­å¯¼èˆª | `<Tabs>` variant="underline" | åº•éƒ¨çº¿æ¡é£æ ¼ |
| `.card` å¡ç‰‡ | `<Card>` | ç›´æ¥ä½¿ç”¨ï¼Œæ ·å¼é€šè¿‡ CSS å˜é‡ç»§æ‰¿ |
| `.stat-card` ç»Ÿè®¡å¡ | `<Card>` + è‡ªå®šä¹‰å¸ƒå±€ | font-mono å±•ç¤ºæ•°å­— |
| `.field-input` è¡¨å• | `<Input>` / `<Select>` | é…åˆ react-hook-form + `<Form>` |
| `.btn-primary` | `<Button>` | variant="default"ï¼ŒèƒŒæ™¯è‰² --foreground |
| `.btn-ghost` | `<Button variant="outline">` | â€” |
| `.btn-danger` | `<Button variant="destructive">` | â€” |
| `.modal` å¼¹çª— | `<Dialog>` | â€” |
| `.dropdown-menu` | `<DropdownMenu>` | â€” |
| `.emp-row` å‘˜å·¥åˆ—è¡¨ | `<Table>` + TanStack Table | å¯æ’åºã€å¯ç­›é€‰ |
| `.detail-table` æ˜ç»†è¡¨ | `<Table>` + TanStack Table | 28 åˆ—æ¨ªå‘æ»šåŠ¨ |
| `.pay-card` è–ªèµ„å¡ç‰‡ | `<Collapsible>` + `<Card>` | å±•å¼€/æ”¶èµ· |
| `.tag` æ ‡ç­¾ | `<Badge>` | variant è‡ªå®šä¹‰ |
| å¼¹å‡ºåˆ†ç±»é¢æ¿ | `<Sheet>` | side="top"ï¼Œä»é¡¶æ ä¸‹æ–¹å±•å¼€ |
| é¢åŒ…å±‘ | `<Breadcrumb>` | â€” |

---

## ä¸‰ã€é¡¹ç›®ç»“æ„ Ã— PRD æ¨¡å—æ˜ å°„

```
China/payroll-app/
â”œâ”€â”€ electron/
â”‚   â”œâ”€â”€ main.ts                        # ä¸»è¿›ç¨‹å…¥å£
â”‚   â””â”€â”€ preload.ts                     # é¢„åŠ è½½è„šæœ¬
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                       # React å…¥å£
â”‚   â”œâ”€â”€ App.tsx                        # æ ¹ç»„ä»¶ + è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â””â”€â”€ AppLayout.tsx              # â† PRD: 02-ui-layout.md
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                         # â† PRD: å„æ¨¡å—æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”œâ”€â”€ OrgSettingsPage.tsx     # â† PRD: 03-mod-settings.md Â§1
â”‚   â”‚   â”‚   â”œâ”€â”€ SocialConfigPage.tsx   # â† PRD: 03-mod-settings.md Â§2
â”‚   â”‚   â”‚   â””â”€â”€ CompanyPage.tsx        # â† PRD: 03-mod-settings.md Â§3
â”‚   â”‚   â”œâ”€â”€ employee/
â”‚   â”‚   â”‚   â”œâ”€â”€ EmployeePage.tsx       # â† PRD: 04-mod-employee.md Â§1
â”‚   â”‚   â”‚   â””â”€â”€ ImportExportPage.tsx   # â† PRD: 07-import-export.md
â”‚   â”‚   â”œâ”€â”€ payroll/
â”‚   â”‚   â”‚   â”œâ”€â”€ PayrollByEmpPage.tsx   # â† PRD: 05-mod-payroll.md Â§ä¸€
â”‚   â”‚   â”‚   â””â”€â”€ PayrollDetailPage.tsx  # â† PRD: 05-mod-payroll.md Â§ä¸€.4
â”‚   â”‚   â”œâ”€â”€ voucher/
â”‚   â”‚   â”‚   â””â”€â”€ VoucherPage.tsx        # â† PRD: 06-mod-voucher.md
â”‚   â”‚   â””â”€â”€ data/
â”‚   â”‚       â”œâ”€â”€ BackupPage.tsx         # â† PRD: 08-data-management.md
â”‚   â”‚       â””â”€â”€ StoragePage.tsx        # â† PRD: 08-data-management.md Â§4
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                        # shadcn/ui åŸºç¡€ç»„ä»¶ï¼ˆnpx shadcn add ç”Ÿæˆï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dropdown-menu.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ form.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tabs.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ breadcrumb.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tooltip.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ popover.tsx
â”‚   â”‚   â”‚   â””â”€â”€ sheet.tsx              # ç”¨äºå¼¹å‡ºåˆ†ç±»é¢æ¿
â”‚   â”‚   â”œâ”€â”€ EmployeeForm.tsx
â”‚   â”‚   â”œâ”€â”€ EmployeeTable.tsx          # åŸºäº TanStack Table + shadcn table
â”‚   â”‚   â”œâ”€â”€ EmployeeDetail.tsx
â”‚   â”‚   â”œâ”€â”€ SocialConfigForm.tsx
â”‚   â”‚   â”œâ”€â”€ CompanyManager.tsx
â”‚   â”‚   â”œâ”€â”€ PayCard.tsx
â”‚   â”‚   â”œâ”€â”€ PaySlip.tsx
â”‚   â”‚   â”œâ”€â”€ VoucherCard.tsx
â”‚   â”‚   â”œâ”€â”€ MonthPicker.tsx
â”‚   â”‚   â”œâ”€â”€ StatsRow.tsx
â”‚   â”‚   â””â”€â”€ ImportConflictModal.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                      # çº¯ä¸šåŠ¡é€»è¾‘ï¼ˆé›¶ UI ä¾èµ–ï¼‰
â”‚   â”‚   â”œâ”€â”€ calculator.ts              # â† PRD: 05-mod-payroll.md Â§äºŒ
â”‚   â”‚   â”œâ”€â”€ voucherGenerator.ts        # â† PRD: 06-mod-voucher.md Â§2-8
â”‚   â”‚   â””â”€â”€ aggregator.ts             # â† PRD: 05-mod-payroll.md Â§äºŒ.2
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ settingsStore.ts
â”‚   â”‚   â”œâ”€â”€ employeeStore.ts
â”‚   â”‚   â”œâ”€â”€ payrollStore.ts
â”‚   â”‚   â””â”€â”€ uiStore.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ client.ts                  # SQLite è¿æ¥ä¸ PRAGMAï¼ˆWAL / foreign_keysï¼‰
â”‚   â”‚   â”œâ”€â”€ migrations/                # schema ç‰ˆæœ¬è¿ç§»
â”‚   â”‚   â””â”€â”€ repos/                     # Repository/DAO
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ cn.ts                      # clsx + tailwind-merge å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ decimal.ts                 # decimal.js å°è£…ï¼ˆå¤ç”¨ HK Accountingï¼‰
â”‚   â”‚   â”œâ”€â”€ uiStorage.ts               # electron-store è½»é…ç½®å°è£…
â”‚   â”‚   â”œâ”€â”€ migrator.ts               # â† PRD: 08-data-management.md Â§5
â”‚   â”‚   â”œâ”€â”€ exportPdf.ts              # â† PRD: 07-import-export.md Â§4
â”‚   â”‚   â”œâ”€â”€ exportExcel.ts            # â† PRD: 07-import-export.md Â§3
â”‚   â”‚   â”œâ”€â”€ importExcel.ts            # â† PRD: 07-import-export.md Â§2
â”‚   â”‚   â””â”€â”€ format.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ i18n/                          # â† PRD: 09-nonfunctional.md Â§4
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ zh-HK.json
â”‚   â”‚   â”œâ”€â”€ zh-CN.json
â”‚   â”‚   â””â”€â”€ en.json
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                         # â† PRD: 01-data-model.md
â”‚   â”‚   â”œâ”€â”€ employee.ts
â”‚   â”‚   â”œâ”€â”€ payroll.ts
â”‚   â”‚   â”œâ”€â”€ voucher.ts
â”‚   â”‚   â””â”€â”€ settings.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ globals.css                # Tailwind æŒ‡ä»¤ + shadcn/ui CSS å˜é‡
â”‚   â”‚
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ utils.ts                   # shadcn/ui é»˜è®¤å·¥å…·ï¼ˆcn å‡½æ•°ï¼‰
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ calculator.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ voucherGenerator.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ aggregator.test.ts
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ decimal.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ migrator.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ format.test.ts
â”‚   â”‚   â””â”€â”€ stores/
â”‚   â”‚       â”œâ”€â”€ settingsStore.test.ts
â”‚   â”‚       â”œâ”€â”€ employeeStore.test.ts
â”‚   â”‚       â””â”€â”€ payrollStore.test.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ component/
â”‚   â”‚   â”œâ”€â”€ EmployeeForm.test.tsx
â”‚   â”‚   â”œâ”€â”€ PayCard.test.tsx
â”‚   â”‚   â”œâ”€â”€ VoucherCard.test.tsx
â”‚   â”‚   â””â”€â”€ SocialConfigForm.test.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ e2e/
â”‚   â”‚   â”œâ”€â”€ payroll-flow.spec.ts
â”‚   â”‚   â”œâ”€â”€ voucher-flow.spec.ts
â”‚   â”‚   â”œâ”€â”€ import-export.spec.ts
â”‚   â”‚   â””â”€â”€ backup-restore.spec.ts
â”‚   â”‚
â”‚   â””â”€â”€ fixtures/
â”‚       â”œâ”€â”€ employees.json
â”‚       â”œâ”€â”€ social-config.json
â”‚       â””â”€â”€ legacy-backup.json
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ components.json                    # shadcn/ui é…ç½®
â”œâ”€â”€ tailwind.config.ts                 # Tailwind CSS é…ç½®
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ vitest.config.ts
â”œâ”€â”€ playwright.config.ts
â”œâ”€â”€ electron-builder.yml
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### ä»£ç å±‚çº§ä¾èµ–å…³ç³»

```
types/           â† PRD: 01-data-model.mdï¼ˆå…¬å…±ç±»å‹ï¼‰
  â†“
services/        â† PRD: 05 + 06ï¼ˆçº¯å‡½æ•°ï¼Œå•å…ƒæµ‹è¯•è¦†ç›–ï¼‰
  â†“
stores/          â† è°ƒç”¨ servicesï¼ˆstore æµ‹è¯•è¦†ç›–ï¼‰
  â†“
components/      â† æ¶ˆè´¹ storesï¼ˆç»„ä»¶æµ‹è¯•è¦†ç›–ï¼‰
  â†“
pages/           â† ç»„åˆ componentsï¼ˆE2E æµ‹è¯•è¦†ç›–ï¼‰
  â†“
App.tsx â†’ electron/main.ts
```

---

## å››ã€æµ‹è¯•ç­–ç•¥

### 4.1 æµ‹è¯•åˆ†å±‚

| å±‚çº§ | å·¥å…· | è¦†ç›–èŒƒå›´ | è¿è¡Œæ—¶æœº |
|------|------|----------|----------|
| **å•å…ƒæµ‹è¯•** | Vitest | services/ã€utils/ã€stores/ | æ¯æ¬¡æäº¤å‰ |
| **ç»„ä»¶æµ‹è¯•** | Vitest + React Testing Library | components/ äº¤äº’é€»è¾‘ | æ¯æ¬¡æäº¤å‰ |
| **E2E æµ‹è¯•** | Playwright | å®Œæ•´ä¸šåŠ¡æµç¨‹ | æ¯ä¸ª Phase å®Œæˆå |

### 4.1.1 æµ‹è¯•ç¯å¢ƒéš”ç¦»å¼€å…³ï¼ˆSQLite å¿…é¡»éµå®ˆï¼‰

| å¼€å…³ | å–å€¼ | ä½œç”¨ | é»˜è®¤å€¼ |
|------|------|------|--------|
| `APP_ENV` | `prod` / `test` | æ§åˆ¶è¿è¡Œæ¨¡å¼ä¸ç ´åæ€§èƒ½åŠ›å¼€å…³ | `prod` |
| `TEST_DB_PATH` | ç»å¯¹è·¯å¾„ | test æ¨¡å¼ä¸‹æŒ‡å®š SQLite æµ‹è¯•åº“ä½ç½® | ç©ºï¼ˆè‡ªåŠ¨ä¸´æ—¶è·¯å¾„ï¼‰ |
| `READ_SOURCE` | `legacy` / `sqlite` | æ§åˆ¶è¯»å–æ¥æºï¼ˆè¿ç§»ç°åº¦ä¸å›æ»šï¼‰ | `legacy`ï¼ˆè¿ç§»æœŸï¼‰ |
| `WRITE_MODE` | `legacy` / `dual` / `sqlite` | æ§åˆ¶å†™å…¥ç­–ç•¥ï¼ˆå•å†™æ—§åº“/åŒå†™/å•å†™æ–°åº“ï¼‰ | `legacy`ï¼ˆè¿ç§»æœŸï¼‰ |

éš”ç¦»è§„åˆ™ï¼ˆå¼ºåˆ¶ï¼‰ï¼š

1. åŠŸèƒ½æµ‹è¯•ã€E2Eã€æ•°æ®åº“é‡ç½®æµ‹è¯•å¿…é¡»ä½¿ç”¨ `APP_ENV=test`
2. `resetDatabase()` ä»…å…è®¸åœ¨ `APP_ENV=test` è°ƒç”¨ï¼Œé test æ¨¡å¼å¿…é¡» fail-fast
3. æ¯è½®æµ‹è¯•å¿…é¡»ä½¿ç”¨ç‹¬ç«‹æµ‹è¯•åº“è·¯å¾„ï¼Œè¿è¡Œåæ¸…ç†ï¼Œä¸å¯å¤ç”¨æ­£å¼åº“
4. æµ‹è¯•å¯åŠ¨æ—¥å¿—å¿…é¡»æ‰“å° `APP_ENV`ã€DB è·¯å¾„ã€`READ_SOURCE`ã€`WRITE_MODE`
5. æ¶‰åŠ `better-sqlite3` çš„æµ‹è¯•å¿…é¡»åŒ¹é…è¿è¡Œæ—¶ ABIï¼š`npm run test` ä½¿ç”¨ Node ABIã€`npm run test:e2e` ä½¿ç”¨ Electron ABI

### 4.2 æµ‹è¯•æ²»ç†æƒå¨æºï¼ˆSingle Source of Truthï¼‰

æµ‹è¯•æ²»ç†è§„åˆ™åªåœ¨æœ¬æ–‡æ¡£ç»´æŠ¤ï¼Œ`China/test/` ç›®å½•åªæ‰¿è½½æ˜ å°„ã€æ ·ä¾‹æ•°æ®å’ŒæŠ¥å‘Šäº§ç‰©ï¼Œä¸å†ç»´æŠ¤ç¬¬äºŒå¥—è§„åˆ™æ–‡æœ¬ã€‚

### 4.3 æµ‹è¯•äº§å‡ºè§„åˆ™åˆ†çº§ï¼ˆå¿…é¡»éµå®ˆï¼‰

#### A. æ—¥å¸¸è¿­ä»£ï¼ˆé˜¶æ®µå†…å°æ‰¹æ¬¡æäº¤ï¼‰

è‡³å°‘äº§å‡ºä»¥ä¸‹ä¸¤é¡¹ï¼š

1. `raw JSON`ï¼šæµ‹è¯•åŸå§‹ç»“æœï¼ˆVitest / Playwrightï¼‰
2. `case map å¯¹è´¦ç»“æœ`ï¼šç†æƒ³è¾“å‡ºä¸å®é™…ç»“æœé€æ¡æ¯”å¯¹ï¼ˆmatch / mismatch / no-evidenceï¼‰

#### B. æ­£å¼é‡Œç¨‹ç¢‘ï¼ˆP0 / P1 / P2 / P3 / P4 é˜¶æ®µå…³é—¨ï¼‰

å¿…é¡»äº§å‡ºå®Œæ•´ä¸‰ä»¶å¥—ï¼š

1. `raw JSON`
2. `case map å¯¹è´¦ç»“æœ`
3. `XLSX æµ‹è¯•æŠ¥å‘Š`

æœªæ»¡è¶³ä¸‰ä»¶å¥—ï¼Œä¸å¾—å®£å¸ƒè¯¥é˜¶æ®µå®Œæˆã€‚

### 4.4 ç›®å½•ä¸å‘½åè§„èŒƒï¼ˆç»Ÿä¸€å£å¾„ï¼‰

#### ç›®å½•å±‚çº§

- ç¬¬ä¸€å±‚ï¼šæµ‹è¯•ç±»å‹ï¼ˆ`01-unit` / `02-component` / `03-e2e`ï¼‰
- ç¬¬äºŒå±‚ï¼šä¸šåŠ¡åœºæ™¯ï¼ˆæ¨èï¼‰  
  ä¾‹å¦‚ï¼š`salary-calc/`ã€`payslip-gen/`ã€`tax-deduction/`
- **P0 ä¾‹å¤–**ï¼šå¹³å°åº•åº§èƒ½åŠ›å…è®¸æŒ‰æŠ€æœ¯åŸŸæ‹†åˆ†  
  ä¾‹å¦‚ï¼š`i18n/`ã€`electron-bridge/`ã€`ui-shell/`

#### æ–‡ä»¶å‘½å

ç»Ÿä¸€ä½¿ç”¨ï¼š

`<phase>.<module>.<scenario>.<scope>.spec.ts`

ç¤ºä¾‹ï¼š

- `p2.payroll.salary-calc.store.spec.ts`
- `p2.payroll.salary-calc.component.spec.tsx`
- `p3.voucher.voucher-balance.e2e.spec.ts`

### 4.5 éœ€æ±‚æ˜ å°„ä¸ç†æƒ³è¾“å‡º

æ¯ä¸ªéœ€æ±‚å¿…é¡»å¯è¿½æº¯åˆ°ï¼š

1. ä¸»è¦é˜¶æ®µï¼ˆP0-P4ï¼‰
2. æ¨¡å—ç¼–ç ï¼ˆsettings / employee / payroll / voucher / import-export / data / i18n / acceptanceï¼‰
3. æµ‹è¯•ç±»å‹ï¼ˆunit / component / e2eï¼‰
4. ç†æƒ³è¾“å‡ºå®šä¹‰ï¼ˆexpected behavior / expected numeric resultï¼‰

ç¼ºå°‘æ˜ å°„æ—¶ï¼Œå…ˆè¡¥ `module-test-map` å’Œ case æ¸…å•ï¼Œå†å†™æµ‹è¯•ã€‚

### 4.6 å®¢è§‚ç»“æœè¦æ±‚ï¼ˆç¦æ­¢è¿åˆï¼‰

- æŠ¥å‘Šä»…å…è®¸åŸºäºæµ‹è¯•å‘½ä»¤çœŸå®è¾“å‡ºç”Ÿæˆ
- å…è®¸å¤±è´¥ç»“æœè¿›å…¥æŠ¥å‘Šï¼Œç¦æ­¢æ‰‹å·¥æ”¹å†™ä¸ºé€šè¿‡
- å¯¹è´¦ç»“æœä½¿ç”¨ä¸‰æ€ï¼š`match` / `mismatch` / `no-evidence`
- ä»»ä¸€ `mismatch` æˆ– `no-evidence` å¿…é¡»åœ¨é˜¶æ®µæ€»ç»“ä¸­æ˜ç¡®åˆ—å‡º

### 4.7 å•å…ƒæµ‹è¯•è¦æ±‚ï¼ˆservices/ â€” æœ€é«˜ä¼˜å…ˆçº§ï¼‰

`services/` æ˜¯æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå¿…é¡» 100% è¦†ç›–ã€‚

#### calculator.test.ts â€” å·¥èµ„è®¡ç®—

```
å¿…é¡»è¦†ç›–çš„åœºæ™¯ï¼ˆå¯¹ç…§ PRD 05-mod-payroll.md Â§äºŒï¼‰ï¼š

âœ… åŸºç¡€è®¡ç®—
  - çº¯åŸºæœ¬å·¥èµ„ï¼ˆæ— ç»©æ•ˆã€æ— ç¤¾ä¿ã€æ— ç¼ºå‹¤ï¼‰â†’ netPay = baseSalary + subsidy
  - å«ç»©æ•ˆå…¨é¡¹ â†’ éªŒè¯ fullGrossPay
  - å«ç¼ºå‹¤æ‰£æ¬¾ â†’ hourlyRate = base / 21.75 / 8
  - å«å…¶ä»–è°ƒæ•´ï¼ˆæ­£æ•° / è´Ÿæ•°ï¼‰

âœ… ç¤¾ä¿è®¡ç®—
  - hasSocial = true â†’ 6 é™©å•ä½ + 3 é™©ä¸ªäººå…¨éƒ¨æ­£ç¡®
  - hasSocial = false â†’ æ‰€æœ‰ç¤¾ä¿é¡¹ = 0
  - hasLocalPension = false â†’ cLocalPension = 0ï¼Œå…¶ä½™æ­£å¸¸
  - æ¯é¡¹å•ç‹¬å››èˆäº”å…¥åˆ° 2 ä½å°æ•°åå†æ±‚å’Œ

âœ… å…¬ç§¯é‡‘
  - fundAmount > 0 â†’ cFund = wFund = fundAmount
  - fundAmount = 0 â†’ cFund = wFund = 0

âœ… å®å‘å·¥èµ„
  - netPay = grossPay - wSocial - wFund - tax

âœ… ç²¾åº¦
  - æ„é€ ç²¾åº¦æ•æ„Ÿæ•°æ®ï¼ŒéªŒè¯ decimal.js æ­£ç¡®æ€§
```

#### voucherGenerator.test.ts â€” å‡­è¯ç”Ÿæˆ

```
å¯¹ç…§ PRD 06-mod-voucher.md Â§2-8ï¼š

âœ… å‡­è¯ â‘ ï¼šå€Ÿæ–¹æŒ‰é”€å”®/ç®¡ç†åˆ†ç±»ã€è´·æ–¹æ±‡æ€»ã€ä»£æ‰£åˆ†å½•ã€å€Ÿè´·å¹³è¡¡
âœ… å‡­è¯ â‘¡â‘¢â‘£ï¼šå„è‡ªå€Ÿè´·å¹³è¡¡ã€é‡‘é¢ä¸º 0 æ—¶æ•´å¼ ä¸ç”Ÿæˆ
âœ… å‡­è¯ â‘¤ï¼šå«/ä¸å«ç¼ºå‹¤æ‰£æ¬¾ä¸¤ç§åœºæ™¯
âœ… ä½™é¢æ ¡éªŒï¼š5 å¼ å‡­è¯å®Œæˆå åº”ä»˜èŒå·¥è–ªé…¬-äººå‘˜å·¥èµ„ = 0
```

#### aggregator.test.ts â€” æ±‡æ€»

```
âœ… æŒ‰ type åˆ†ç±»ï¼ˆé”€å”® / ç®¡ç†ï¼‰
âœ… å…¨å‘˜åˆè®¡ = é”€å”® + ç®¡ç†
âœ… ç²¾åº¦è§„åˆ™ï¼šå…ˆç´¯åŠ åŸå§‹å€¼ï¼Œæœ€åç»Ÿä¸€å››èˆäº”å…¥
âœ… æŒ‰å…¬å¸ä¸»ä½“ç­›é€‰
```

### 4.8 ç»„ä»¶æµ‹è¯•è¦æ±‚

```
EmployeeForm     â€” å¿…å¡«æ ¡éªŒã€æäº¤æ•°æ®æ­£ç¡®æ€§ã€é»˜è®¤å€¼
PayCard          â€” ç”Ÿæˆ/æœªç”ŸæˆçŠ¶æ€åˆ‡æ¢ã€è®¡ç®—ç»“æœæ˜¾ç¤º
VoucherCard      â€” å€Ÿè´·å¹³è¡¡æ ‡è¯†ã€é›¶å€¼è¡Œéšè—
SocialConfigForm â€” ä¿®æ”¹åç¤ºä¾‹å®æ—¶æ›´æ–°
```

### 4.9 E2E æµ‹è¯•è¦æ±‚

```
payroll-flow.spec.ts    â€” åˆ›å»ºå‘˜å·¥ â†’ è¾“å…¥å˜é‡ â†’ ç”Ÿæˆå·¥èµ„æ¡ â†’ éªŒè¯é‡‘é¢
voucher-flow.spec.ts    â€” ç”Ÿæˆå·¥èµ„æ¡ â†’ 5 å¼ å‡­è¯ â†’ å€Ÿè´·å¹³è¡¡ â†’ ç­›é€‰
import-export.spec.ts   â€” ä¸‹è½½æ¨¡æ¿ â†’ å¯¼å…¥ â†’ å†²çªå¤„ç† â†’ éªŒè¯
backup-restore.spec.ts  â€” æ·»åŠ æ•°æ® â†’ å¤‡ä»½ â†’ æ¸…ç©º â†’ æ¢å¤ â†’ éªŒè¯ä¸€è‡´
db-isolation.spec.ts    â€” APP_ENV=test ä¸‹æ‰§è¡Œé‡ç½®ï¼›éªŒè¯æ­£å¼æ¨¡å¼è°ƒç”¨è¢«æ‹’ç»
```

### 4.10 æµ‹è¯•æ•°æ®ï¼ˆtests/fixtures/ï¼‰

```
employees.json â€” è‡³å°‘ 4 äººï¼š
  - 2 åé”€å”®ï¼ˆhasSocial=true / false å„ 1ï¼‰
  - 2 åç®¡ç†ï¼ˆhasLocalPension=true / false å„ 1ï¼‰
  - åˆ†å±ä¸åŒå…¬å¸ä¸»ä½“

social-config.json â€” ä½¿ç”¨ PRD 01-data-model.md é»˜è®¤å€¼

legacy-backup.json â€” åŸç³»ç»ŸçœŸå®å¤‡ä»½ï¼ˆå…¼å®¹æ€§æµ‹è¯•ï¼‰
```

### 4.11 æµ‹è¯•å‘½ä»¤

```bash
npm run test              # å…ˆ abi:nodeï¼Œå†è·‘ vitestï¼ˆå•å…ƒ + ç»„ä»¶ï¼‰
npm run test:watch        # vitest --watch
npm run test:coverage     # vitest run --coverage
npm run test:e2e          # å…ˆ abi:electronï¼Œå†è·‘ playwright test
npm run test:all          # npm run test && npm run test:e2eï¼ˆè‡ªåŠ¨å®ŒæˆåŒ ABI åˆ‡æ¢ï¼‰
```

> SQLite ç›¸å…³æµ‹è¯•ä¸€å¾‹åœ¨ `APP_ENV=test` è¿è¡Œï¼Œå¹¶æŒ‡å®š `TEST_DB_PATH`ï¼ˆæˆ–ç”±æµ‹è¯•æ¡†æ¶ç”Ÿæˆä¸´æ—¶è·¯å¾„ï¼‰ï¼›ç¦æ­¢ä½¿ç”¨æ­£å¼åº“è·¯å¾„ã€‚
>
> éå¿…è¦ä¸è¦ç›´æ¥è°ƒç”¨ `vitest` / `playwright test` è£¸å‘½ä»¤ã€‚è‹¥å¿…é¡»ç›´è·‘ï¼Œå…ˆæ‰‹åŠ¨æ‰§è¡Œ `npm run abi:node` æˆ– `npm run abi:electron`ï¼Œå¦åˆ™å¯èƒ½è§¦å‘ `NODE_MODULE_VERSION` mismatchã€‚

---

## äº”ã€ä¸åŸç³»ç»Ÿçš„å…³é”®å·®å¼‚

| ç»´åº¦ | åŸç³»ç»Ÿ | é‡æ„å |
|------|--------|--------|
| ä»£ç ç»„ç»‡ | å•æ–‡ä»¶ 2304 è¡Œ | ~30 ä¸ªæ–‡ä»¶ï¼Œå•ä¸ª < 200 è¡Œ |
| é‡‘é¢è®¡ç®— | `Math.round(n*100)/100` | `decimal.js` ç²¾ç¡®è®¡ç®— |
| æ•°æ®å­˜å‚¨ | localStorageï¼ˆ5MBï¼‰ | SQLiteï¼ˆä¸šåŠ¡ä¸»æ•°æ®ï¼‰+ electron-storeï¼ˆUI è½»é…ç½®ï¼‰ |
| ç±»å‹å®‰å…¨ | æ—  | TypeScript strict |
| çŠ¶æ€ç®¡ç† | å…¨å±€å˜é‡ | Zustand å“åº”å¼ |
| UI æ¸²æŸ“ | innerHTML æ‹¼æ¥ | React + shadcn/ui + Tailwind CSS |
| å¤šè¯­è¨€ | ç¡¬ç¼–ç ä¸­æ–‡ | i18next ä¸‰è¯­ |
| æµ‹è¯• | æ—  | å•å…ƒ + ç»„ä»¶ + E2E ä¸‰å±‚ |
| éƒ¨ç½² | æ‰“å¼€ HTML | åŒå‡»å®‰è£…æ¡Œé¢åº”ç”¨ |

---

## å…­ã€å¯å¤ç”¨ HK Accounting çš„ä»£ç 

| æ–‡ä»¶ | æ¥æº | ç”¨é€” |
|------|------|------|
| `decimal.ts` | HK Accounting `src/lib/decimal.ts` | é‡‘é¢è®¡ç®— |
| CSS å˜é‡ä½“ç³» | HK Accounting ä¸»é¢˜è‰² + é—´è· â†’ æ˜ å°„åˆ° shadcn/ui CSS å˜é‡ | è§†è§‰ä¸€è‡´ |
| Zustand persist | HK Accounting companyStore æ¨¡å¼ | çŠ¶æ€æŒä¹…åŒ– |

---

## ä¸ƒã€å·²ç¡®è®¤å†³ç­–

| äº‹é¡¹ | å†³ç­– | å½±å“ |
|------|------|------|
| **UI ç»„ä»¶åº“** | âœ… shadcn/ui + Tailwind CSSï¼ˆæ›¿ä»£ Ant Designï¼‰ | å…¨ç»„ä»¶å±‚ |
| **UI é£æ ¼** | âœ… å…¨æ–°è®¾è®¡ï¼ˆå»¶ç»­åŸ Demo æš–è‰²è°ƒé…è‰²ï¼‰ | P0 å‡ºè®¾è®¡è§„èŒƒ |
| **å›½é™…åŒ–** | âœ… ä¸‰è¯­ | P0 å®Œæˆæ¡†æ¶ |
| **æ—§æ•°æ®å…¼å®¹** | âœ… æ”¯æŒå¯¼å…¥ï¼ˆPRD `08 Â§5`ï¼‰ | P1 å®Œæˆ |
| **è¿ç§»å›æ»šå¼€å…³** | âœ… `READ_SOURCE=legacy|sqlite`ã€`WRITE_MODE=legacy|dual|sqlite` | P1-P3 å¯ç°åº¦æ¨è¿›ä¸å›æ»š |
| **æµ‹è¯•ç¯å¢ƒéš”ç¦»** | âœ… `APP_ENV=test` + `TEST_DB_PATH` + reset å®‰å…¨é—¸ | åŠŸèƒ½æµ‹è¯•å¯å®‰å…¨æ‰§è¡Œæ¸…åº“/é‡ç½® |
| **æµ‹è¯•** | âœ… ä¸‰å±‚ï¼ˆå•å…ƒ + ç»„ä»¶ + E2Eï¼‰ | å„ Phase é›†æˆ |
| **åº”ç”¨åç§°** | âš ï¸ å¾…ç¡®è®¤ | æ‰“åŒ…å‰ç¡®å®š |

---

## å…«ã€å¼€å‘é˜¶æ®µ

### é˜¶æ®µæ‰§è¡Œè§„èŒƒï¼ˆæ¯ä¸ª Phase é€šç”¨ï¼‰

```
Phase å¼€å§‹å‰ï¼š
  1. è¯»å–æœ¬æ–‡æ¡£å¯¹åº”é˜¶æ®µçš„ã€Œéœ€è¯» PRDã€åˆ—è¡¨
  2. ç¡®è®¤å‰ç½® Phase å·²å®Œæˆä¸”æµ‹è¯•é€šè¿‡
  3. è‹¥æœ¬è½®æ¶‰åŠæµ‹è¯•æ‰§è¡Œï¼Œå…ˆç¡®è®¤ APP_ENV=test ä¸” TEST_DB_PATH æŒ‡å‘ä¸´æ—¶ç›®å½•

Phase æ‰§è¡Œä¸­ï¼š
  4. ä¸¥æ ¼æŒ‰ PRD å­—æ®µåã€ç±»å‹ã€å…¬å¼å®ç°
  5. é‡åˆ°ä¸ç¡®å®šçš„æŠ€æœ¯ç»†èŠ‚ â†’ MCP è”ç½‘æŸ¥å®˜æ–¹æ–‡æ¡£
  6. è”ç½‘å¤±è´¥ â†’ ç«‹å³åœæ­¢ï¼Œå‘ŠçŸ¥ç”¨æˆ·
  7. æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡ â†’ å¯¹ç…§ PRD è‡ªæ£€
  8. ä¸šåŠ¡é€»è¾‘ä»£ç ï¼ˆservices/ï¼‰å†™å®Œåç«‹å³å†™å¯¹åº”å•å…ƒæµ‹è¯•

Phase å®Œæˆåï¼š
  9. è¿è¡Œ npm run testï¼ˆå•å…ƒ + ç»„ä»¶ï¼‰
  10. è¿è¡Œå¯¹åº” E2E æµ‹è¯•
  11. äº§å‡ºæµ‹è¯•è¯æ®ï¼ˆæŒ‰ 4.3 åˆ†çº§è§„åˆ™ï¼‰ï¼š
      - æ—¥å¸¸è¿­ä»£ï¼šraw JSON + case map å¯¹è´¦
      - æ­£å¼é‡Œç¨‹ç¢‘ï¼šraw JSON + case map å¯¹è´¦ + XLSX æŠ¥å‘Š
  12. å…¨éƒ¨é€šè¿‡ä¸”è¯æ®é½å…¨åæ‰å¯è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
```

---

### P0ï¼šåŸºç¡€æ¡†æ¶ + è®¾è®¡ç³»ç»Ÿ + æµ‹è¯•åŸºå»ºï¼ˆç¬¬ 1 å¤©ï¼‰

> ğŸ“„ éœ€è¯» PRDï¼š`00-INDEX.md` + `01-data-model.md` + `02-ui-layout.md` + `09-nonfunctional.md Â§4`\
> ğŸ” éœ€è”ç½‘æŸ¥è¯ï¼šVite+Electron æ•´åˆã€shadcn/ui å®‰è£…é…ç½®ã€Tailwind CSS 4.x é…ç½®ã€Vitest é…ç½®

| ä»»åŠ¡ | äº§å‡º |
|------|------|
| åˆå§‹åŒ– Vite + React + TS + Electron é¡¹ç›® | `npm run dev` å¯åŠ¨çª—å£ |
| UI è®¾è®¡è§„èŒƒ | `globals.css` + è®¾è®¡æ–‡æ¡£ |
| Tailwind CSS + shadcn/ui é…ç½® + ä¸»é¢˜å˜é‡ | æ ·å¼ç³»ç»Ÿå°±ç»ª |
| shadcn/ui åŸºç¡€ç»„ä»¶å®‰è£…ï¼ˆbutton, card, dialog, table, form, input, select, tabs, badge, breadcrumb, tooltip, sheetï¼‰ | ç»„ä»¶åº“å°±ç»ª |
| Zustand é…ç½® | çŠ¶æ€ç®¡ç†å°±ç»ª |
| i18next é…ç½® + ä¸‰è¯­è¨€åŒ…éª¨æ¶ | å›½é™…åŒ–å°±ç»ª |
| AppLayout + é¡¶æ å¯¼èˆª + å¼¹å‡ºåˆ†ç±»é¢æ¿ + è·¯ç”± | å¯¼èˆªå¯åˆ‡æ¢ |
| electron-store è½»é…ç½®æ¡¥æ¥ | UI çŠ¶æ€æŒä¹…åŒ–å°±ç»ª |
| SQLite åˆå§‹åŒ–ï¼ˆWAL + foreign_keysï¼‰ | ä¸»æ•°æ®æŒä¹…åŒ–åŸºç¡€å°±ç»ªï¼ˆP1 å¯ç”¨ï¼‰ |
| å®šä¹‰ TypeScript ç±»å‹ï¼ˆ`types/`ï¼‰ | ç±»å‹å…¨éƒ¨å®Œæˆ |
| **Vitest + RTL + Playwright é…ç½®** | **æµ‹è¯•æ¡†æ¶å°±ç»ª** |
| **åˆ›å»º `tests/fixtures/`** | **æµ‹è¯•æ•°æ®å°±ç»ª** |

### P1ï¼šåŸºç¡€è®¾ç½® + äººå‘˜ç®¡ç† + æ•°æ®ç®¡ç†ï¼ˆç¬¬ 2-3 å¤©ï¼‰

> ğŸ“„ éœ€è¯» PRDï¼š`01-data-model.md` + `03-mod-settings.md` + `04-mod-employee.md` + `07-import-export.md` + `08-data-management.md`\
> ğŸ” éœ€è”ç½‘æŸ¥è¯ï¼šSheetJS å¯¼å…¥ APIã€SQLite äº‹åŠ¡/WALã€better-sqlite3 APIã€electron-store APIï¼ˆè½»é…ç½®ï¼‰

| ä»»åŠ¡ | äº§å‡º | PRD | æµ‹è¯• |
|------|------|-----|------|
| db/client + migrations | SQLite åˆå§‹åŒ–ã€schema ç‰ˆæœ¬è¿ç§»ã€WAL/foreign_keys å›ºåŒ– | `01` + `08 Â§4` | db å•å…ƒ |
| Repository æŠ½è±¡ï¼ˆlegacy/sqliteï¼‰ | æ•°æ®è®¿é—®å±‚å¯åˆ‡æ¢ï¼Œæ”¯æ’‘è¯»å†™ç°åº¦ | `01` | å•å…ƒæµ‹è¯• |
| æµ‹è¯•æ²™ç›’åŸºå»ºï¼ˆAPP_ENV / TEST_DB_PATHï¼‰ | åŠŸèƒ½æµ‹è¯•ä¸´æ—¶åº“ç”Ÿå‘½å‘¨æœŸ + reset å®‰å…¨é—¸ | `08 Â§3-4` + `09 Â§2` | å•å…ƒ + E2E |
| settingsStore + OrgSettingsPage | ç»„ç»‡åç§°ã€ç»Ÿè®¡æ¦‚è§ˆ | `03 Â§1` | store å•å…ƒ |
| SocialConfigPage | ç¤¾ä¿é…ç½®è¡¨å• | `03 Â§2` | ç»„ä»¶æµ‹è¯• |
| CompanyPage | å…¬å¸ä¸»ä½“ CRUD | `03 Â§3` | store å•å…ƒ |
| employeeStore + EmployeePage | å‘˜å·¥ CRUD | `04 Â§1` | store å•å…ƒ |
| EmployeeForm + EmployeeDetail | å¼¹çª—ã€è¯¦æƒ… | `04 Â§1` | ç»„ä»¶æµ‹è¯• |
| ImportExportPage | Excel å¯¼å…¥å¯¼å‡º | `07` | E2E |
| BackupPage | å¤‡ä»½/æ¢å¤/æ¸…ç©º | `08 Â§1-3` | E2Eï¼ˆtest æ²™ç›’ï¼‰ |
| StoragePage | å­˜å‚¨ä¿¡æ¯ | `08 Â§4` | â€” |
| migrator.ts | æ—§æ•°æ®å¯¼å…¥ | `08 Â§5` | å•å…ƒæµ‹è¯• |

âœ… **P1 å®Œæˆé—¨æ§›**ï¼š`npm run test` é€šè¿‡ + `backup-restore.spec.ts` ä¸ `db-isolation.spec.ts` é€šè¿‡ + é‡Œç¨‹ç¢‘ä¸‰ä»¶å¥—è¯æ®é½å…¨ï¼ˆè§ 4.3ï¼‰

> **å½“å‰çŠ¶æ€ï¼ˆ2026-02-14ï¼‰**ï¼šå·²è¾¾æˆã€‚\
> æ”¶å£ç‰ˆæœ¬ï¼š`2.1.2-p1-sqlite-finish`\
> å½“å‰éªŒè¯ï¼š`npm run test`ï¼ˆ67/67ï¼‰ã€å…³é”® E2Eï¼ˆ4/4ï¼‰ã€case map `match=25/mismatch=0/noEvidence=0`

### P2ï¼šè–ªèµ„æ ¸ç®—ï¼ˆç¬¬ 3-4 å¤©ï¼‰

> ğŸ“„ éœ€è¯» PRDï¼š`01-data-model.md` + `05-mod-payroll.md`\
> ğŸ” éœ€è”ç½‘æŸ¥è¯ï¼šjsPDF ä¸­æ–‡å­—ä½“æ–¹æ¡ˆ

| ä»»åŠ¡ | äº§å‡º | PRD | æµ‹è¯• |
|------|------|-----|------|
| **calculator.ts** | ğŸ”‘ æ ¸å¿ƒè®¡ç®— | `05 Â§äºŒ` | **calculator.test.ts** |
| payrollStore + PayrollByEmpPage | è–ªèµ„é¡µé¢ | `05 Â§ä¸€` | store å•å…ƒ |
| PayCard | è–ªèµ„å¡ç‰‡ | `05 Â§ä¸€.3` | ç»„ä»¶æµ‹è¯• |
| PaySlip | å·¥èµ„æ¡é¢„è§ˆ | `05 Â§ä¸€.3` | â€” |
| PayrollDetailPage | 28 åˆ—æ˜ç»†è¡¨ | `05 Â§ä¸€.4` | â€” |
| PDF æ‰¹é‡å¯¼å‡º | å…¨å‘˜å¯¼å‡º | `07 Â§3-4` | â€” |

âœ… **P2 å®Œæˆé—¨æ§›**ï¼š`calculator.test.ts` é€šè¿‡ + `payroll-flow.spec.ts` é€šè¿‡ + é‡Œç¨‹ç¢‘ä¸‰ä»¶å¥—è¯æ®é½å…¨ï¼ˆè§ 4.3ï¼‰

### P3ï¼šä¼šè®¡å‡­è¯ï¼ˆç¬¬ 4-5 å¤©ï¼‰

> ğŸ“„ éœ€è¯» PRDï¼š`01-data-model.md` + `06-mod-voucher.md`

| ä»»åŠ¡ | äº§å‡º | PRD | æµ‹è¯• |
|------|------|-----|------|
| **voucherGenerator.ts** | ğŸ”‘ 5 å¼ å‡­è¯ | `06 Â§2-6` | **voucherGenerator.test.ts** |
| **aggregator.ts** | å…¨å‘˜æ±‡æ€» | `05 Â§äºŒ.2` | **aggregator.test.ts** |
| VoucherCard | å‡­è¯å¡ç‰‡ | `06 Â§7` | ç»„ä»¶æµ‹è¯• |
| VoucherPage | å‡­è¯é¡µé¢ + ç­›é€‰ | `06 Â§1` | â€” |
| å‡­è¯ CSV å¯¼å‡º | å¯¼å‡º | `07 Â§3` | â€” |
| ä½™é¢æ ¡éªŒ | åº”ä»˜è–ªé…¬ = 0 | `06 Â§8` | å«åœ¨ voucher æµ‹è¯•ä¸­ |

âœ… **P3 å®Œæˆé—¨æ§›**ï¼š`voucherGenerator.test.ts` é€šè¿‡ + `voucher-flow.spec.ts` é€šè¿‡ + é‡Œç¨‹ç¢‘ä¸‰ä»¶å¥—è¯æ®é½å…¨ï¼ˆè§ 4.3ï¼‰

### P4ï¼šæ‰“åŒ… + å…¨é‡æµ‹è¯•ï¼ˆç¬¬ 5 å¤©ï¼‰

> ğŸ“„ éœ€è¯» PRDï¼š`09-nonfunctional.md` + `10-acceptance.md`\
> ğŸ” éœ€è”ç½‘æŸ¥è¯ï¼šelectron-builder dmg/exe ç­¾å

| ä»»åŠ¡ | äº§å‡º |
|------|------|
| electron-builder é…ç½® | .dmg + .exe |
| åº”ç”¨å›¾æ ‡ | è‡ªå®šä¹‰å›¾æ ‡ |
| ä¸‰è¯­è¨€åŒ…å®Œå–„ | ~200 key ç¿»è¯‘å®Œæˆ |
| **`npm run test:all` å…¨é‡æµ‹è¯•** | **å…¨éƒ¨é€šè¿‡** |
| **`10-acceptance.md` é€é¡¹éªŒæ”¶** | **A-01~A-12, B-01~B-08 å…¨ âœ“** |

---

### å¼€å‘é˜¶æ®µ Ã— PRD Ã— æµ‹è¯• æ€»è§ˆ

| é˜¶æ®µ | éœ€åŠ è½½ PRD | è¡Œæ•° | å…³é”®æµ‹è¯• | å®Œæˆé—¨æ§› |
|:----:|-----------|:----:|----------|----------|
| P0 | 00+01+02+09 | ~380 | å†’çƒŸæµ‹è¯• | æ¡†æ¶å¯è¿è¡Œ + é‡Œç¨‹ç¢‘ä¸‰ä»¶å¥— âœ“ |
| P1 | 01+03+04+07+08 | ~400 | store + backup E2E | `npm test` âœ“ + ä¸‰ä»¶å¥— âœ“ |
| P2 | 01+05 | ~300 | **calculator å•å…ƒ** | calculator âœ“ + E2E âœ“ + ä¸‰ä»¶å¥— âœ“ |
| P3 | 01+06 | ~370 | **voucher å•å…ƒ** | voucher âœ“ + E2E âœ“ + ä¸‰ä»¶å¥— âœ“ |
| P4 | 09+10 | ~75 | **å…¨é‡** | `test:all` âœ“ + éªŒæ”¶ âœ“ + ä¸‰ä»¶å¥— âœ“ |

### é˜¶æ®µæ‰§è¡ŒçŠ¶æ€ï¼ˆ2026-02-14ï¼‰

| é˜¶æ®µ | çŠ¶æ€ | ä¸‹ä¸€åŠ¨ä½œ |
|:----:|------|----------|
| P0 | å·²å®Œæˆ | ä»…ç»´æŠ¤ |
| P1 | å·²å®Œæˆ | ä»…å›å½’ç»´æŠ¤ |
| P2 | æœªå¼€å§‹ | å…ˆè½ `calculator.ts` ä¸ `payroll-flow.spec.ts` |
| P3 | æœªå¼€å§‹ | åœ¨ P2 æ±‡æ€»ç¨³å®šåè¿›å…¥ |
| P4 | æœªå¼€å§‹ | æœ€ç»ˆæ‰“åŒ…éªŒæ”¶ |

---

> **æ–‡æ¡£å®šä½æ€»ç»“**
>
> æœ¬æ–‡æ¡£ = é¡¹ç›®çš„ `CLAUDE.md`ï¼Œæ˜¯ AI è¾…åŠ©å¼€å‘çš„å”¯ä¸€è¡Œä¸ºå‡†åˆ™ï¼š
> - **ç¬¬ä¸€ç« **ï¼šæ¯æ¬¡å¯¹è¯å¼€å§‹æ—¶å›é¡¾ï¼ˆè¡Œä¸ºçº¢çº¿ï¼‰
> - **ç¬¬ä¸‰ç« **ï¼šåˆ›å»ºæ–‡ä»¶æ—¶å‚ç…§ï¼ˆé¡¹ç›®ç»“æ„ï¼‰
> - **ç¬¬å››ç« **ï¼šå†™å®Œä»£ç åç«‹å³å†™æµ‹è¯•ï¼ˆæµ‹è¯•ç­–ç•¥ï¼‰
> - **ç¬¬å…«ç« **ï¼šæŒ‰ Phase æ‰§è¡Œï¼Œæµ‹è¯•é€šè¿‡æ‰èƒ½ç»§ç»­ï¼ˆå¼€å‘é˜¶æ®µï¼‰
>
> é…åˆ `China/Devolop files SOP/` æ–‡ä»¶å¤¹ä½¿ç”¨ï¼šæœ¬æ–‡æ¡£å®šä¹‰ã€Œæ€ä¹ˆåšã€ï¼ŒPRD å®šä¹‰ã€Œåšä»€ä¹ˆã€ã€‚
