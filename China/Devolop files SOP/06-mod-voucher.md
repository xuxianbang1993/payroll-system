---
module: 会计凭证
version: 1.1
depends_on: [01-data-model.md, 05-mod-payroll.md]
consumed_by: []
pages:
  - /voucher
change_log:
  - v1.1: 增加阶段状态说明，明确依赖 P2 汇总能力后进入 P3 实施
---

# 会计凭证模块

凭证总览页（/voucher）。系统自动生成 **5 张会计凭证**，对应工资核算的完整会计处理流程。

---

## 1. 凭证总览

| 凭证 | 标题 | 会计动作 | 时间点 |
|:----:|------|----------|--------|
| ① | 计提 YYYY-MM 月工资 | 确认工资费用和应付义务 | 月末 |
| ② | 缴纳 YYYY-MM 社保 | 支付社保给社保局 | 次月 |
| ③ | 支付 YYYY-MM 公积金 | 支付公积金给公积金中心 | 次月 |
| ④ | 缴纳 YYYY-MM 个税 | 代缴个税给税务局 | 次月 |
| ⑤ | 发放 YYYY-MM 月工资 | 发放实发工资给员工 | 次月 |

**通用规则**：
- 所有凭证均自动校验借贷平衡（`|借方合计 - 贷方合计| < 0.01`）
- 金额为 0 的分录行不显示
- 所有分录行为 0 的凭证整张不显示
- 每张凭证显示借方合计、贷方合计、平衡状态

---

## 2. 凭证 ① — 计提月工资

**会计含义**：月末确认本月工资费用，同时确认对员工的应付义务。

**数据来源**：汇总数据 `agg`（含 `sale`、`manage`、`total` 三个维度）

### 第一部分：费用确认（借方）

按人员类型分别记入不同费用科目：

| 条件 | 方向 | 科目 | 金额 | 取数来源 |
|------|:----:|------|------|----------|
| sale.fullGrossPay > 0 | 借 | 销售费用-销售人员职工薪酬-人员工资 | sale.fullGrossPay | 销售人员应计工资总额 |
| sale.cSocial > 0 | 借 | 销售费用-销售人员职工薪酬-社保（单位部分） | sale.cSocial | 销售人员单位社保总额 |
| sale.cFund > 0 | 借 | 销售费用-销售人员职工薪酬-公积金（单位部分） | sale.cFund | 销售人员单位公积金总额 |
| manage.fullGrossPay > 0 | 借 | 管理费用-管理人员职工薪酬-人员工资 | manage.fullGrossPay | 管理人员应计工资总额 |
| manage.cSocial > 0 | 借 | 管理费用-管理人员职工薪酬-社保（单位部分） | manage.cSocial | 管理人员单位社保总额 |
| manage.cFund > 0 | 借 | 管理费用-管理人员职工薪酬-公积金（单位部分） | manage.cFund | 管理人员单位公积金总额 |

### 第二部分：应付义务确认（贷方）

汇总后按科目归集（不区分人员类型）：

| 条件 | 方向 | 科目 | 金额 | 取数来源 |
|------|:----:|------|------|----------|
| total.fullGrossPay > 0 | 贷 | 应付职工薪酬-人员工资 | total.fullGrossPay | 全员应计工资总额 |
| total.cSocial > 0 | 贷 | 应付职工薪酬-社保（单位部分） | total.cSocial | 全员单位社保总额 |
| total.cFund > 0 | 贷 | 应付职工薪酬-公积金（单位部分） | total.cFund | 全员单位公积金总额 |

### 第三部分：个人代扣（附属分录）

从应付工资中扣除代扣项（社保个人部分、公积金个人部分、个税），转入代扣代缴科目：

| 条件 | 方向 | 科目 | 金额 | 取数来源 |
|------|:----:|------|------|----------|
| totalDeduct > 0 | 借 | 应付职工薪酬-人员工资 | wSocial + wFund + tax | 个人代扣总额 |
| total.wSocial > 0 | 贷 | 其他应收款-社保（个人部分） | total.wSocial | 全员个人社保总额 |
| total.wFund > 0 | 贷 | 其他应收款-公积金（个人部分） | total.wFund | 全员个人公积金总额 |
| total.tax > 0 | 贷 | 应交税费-应交个人所得税 | total.tax | 全员个税总额 |

### 借贷平衡验证

```
借方合计 = sale.(fullGrossPay + cSocial + cFund)
         + manage.(fullGrossPay + cSocial + cFund)
         + (wSocial + wFund + tax)

贷方合计 = total.(fullGrossPay + cSocial + cFund)
         + wSocial + wFund + tax

验证：借方合计 === 贷方合计
（因为 sale.X + manage.X === total.X，所以天然平衡）
```

### 凭证 ① 完整示例

> 假设：2 名销售（应计工资合计 20000，单位社保 3000，单位公积金 1000），1 名管理（应计工资 10000，单位社保 1500，单位公积金 500），全员个人社保 2000，个人公积金 750，个税 500。

```
借：销售费用-销售人员职工薪酬-人员工资          20,000.00
借：销售费用-销售人员职工薪酬-社保（单位部分）    3,000.00
借：销售费用-销售人员职工薪酬-公积金（单位部分）   1,000.00
借：管理费用-管理人员职工薪酬-人员工资          10,000.00
借：管理费用-管理人员职工薪酬-社保（单位部分）    1,500.00
借：管理费用-管理人员职工薪酬-公积金（单位部分）     500.00
  贷：应付职工薪酬-人员工资                    30,000.00
  贷：应付职工薪酬-社保（单位部分）              4,500.00
  贷：应付职工薪酬-公积金（单位部分）             1,500.00
                          ─── 个人代扣部分 ───
借：应付职工薪酬-人员工资                        3,250.00
  贷：其他应收款-社保（个人部分）                 2,000.00
  贷：其他应收款-公积金（个人部分）                 750.00
  贷：应交税费-应交个人所得税                       500.00
```

---

## 3. 凭证 ② — 缴纳社保

**会计含义**：将已计提的社保（单位 + 个人部分）实际支付给社保局。

| 条件 | 方向 | 科目 | 金额 | 取数来源 |
|------|:----:|------|------|----------|
| total.cSocial > 0 | 借 | 应付职工薪酬-社保（单位部分） | total.cSocial | 全员单位社保总额 |
| total.wSocial > 0 | 借 | 其他应收款-社保（个人部分） | total.wSocial | 全员个人社保总额 |
| 有社保 | 贷 | 银行存款 | total.cSocial + total.wSocial | 社保总额（单位+个人） |

**借贷平衡**：`cSocial + wSocial === cSocial + wSocial` ✓

**资金流向解读**：
- 借方冲减「应付职工薪酬」和「其他应收款」（之前计提时确认的负债）
- 贷方从银行付出实际资金

---

## 4. 凭证 ③ — 支付公积金

**会计含义**：将已计提的公积金（单位 + 个人部分）实际支付给公积金中心。

| 条件 | 方向 | 科目 | 金额 | 取数来源 |
|------|:----:|------|------|----------|
| total.cFund > 0 | 借 | 应付职工薪酬-公积金（单位部分） | total.cFund | 全员单位公积金总额 |
| total.wFund > 0 | 借 | 其他应收款-公积金（个人部分） | total.wFund | 全员个人公积金总额 |
| 有公积金 | 贷 | 银行存款 | total.cFund + total.wFund | 公积金总额（单位+个人） |

**借贷平衡**：`cFund + wFund === cFund + wFund` ✓

---

## 5. 凭证 ④ — 缴纳个税

**会计含义**：将代扣的个人所得税实际缴纳给税务局。

| 条件 | 方向 | 科目 | 金额 | 取数来源 |
|------|:----:|------|------|----------|
| total.tax > 0 | 借 | 应交税费-应交个人所得税 | total.tax | 全员个税总额 |
| total.tax > 0 | 贷 | 银行存款 | total.tax | 全员个税总额 |

**借贷平衡**：`tax === tax` ✓

---

## 6. 凭证 ⑤ — 发放工资

**会计含义**：将实发工资转入员工银行账户，同时处理缺勤扣款。

### 第一部分：发放实发工资

| 条件 | 方向 | 科目 | 金额 | 取数来源 |
|------|:----:|------|------|----------|
| total.netPay > 0 | 借 | 应付职工薪酬-人员工资 | total.netPay | 全员实发工资总额 |
| total.netPay > 0 | 贷 | 银行存款 | total.netPay | 全员实发工资总额 |

### 第二部分：缺勤扣款（仅在有缺勤时出现）

| 条件 | 方向 | 科目 | 金额 | 取数来源 |
|------|:----:|------|------|----------|
| total.absentDeduct > 0 | 借 | 应付职工薪酬-人员工资 | total.absentDeduct | 全员缺勤扣款总额 |
| total.absentDeduct > 0 | 贷 | 营业外收入-违纪扣款 | total.absentDeduct | 全员缺勤扣款总额 |

**借贷平衡**：`netPay + absentDeduct === netPay + absentDeduct` ✓

**缺勤扣款的会计处理解读**：
- 计提凭证（①）中，工资按「应计工资」（fullGrossPay）全额计提，含缺勤扣款部分
- 发放凭证（⑤）中，实际只发 netPay（不含缺勤扣款），差额部分（absentDeduct）从「应付职工薪酬」转入「营业外收入-违纪扣款」
- 这样可以确保「应付职工薪酬-人员工资」科目最终余额为 0

---

## 7. 凭证科目汇总表

| 科目 | 出现在凭证 | 借方 | 贷方 |
|------|:---------:|------|------|
| 销售费用-销售人员职工薪酬-人员工资 | ① | fullGrossPay（销售） | — |
| 销售费用-销售人员职工薪酬-社保（单位部分） | ① | cSocial（销售） | — |
| 销售费用-销售人员职工薪酬-公积金（单位部分） | ① | cFund（销售） | — |
| 管理费用-管理人员职工薪酬-人员工资 | ① | fullGrossPay（管理） | — |
| 管理费用-管理人员职工薪酬-社保（单位部分） | ① | cSocial（管理） | — |
| 管理费用-管理人员职工薪酬-公积金（单位部分） | ① | cFund（管理） | — |
| 应付职工薪酬-人员工资 | ①⑤ | 代扣总额 + netPay + absentDeduct | fullGrossPay（全员） |
| 应付职工薪酬-社保（单位部分） | ①② | cSocial（全员）[②借] | cSocial（全员）[①贷] |
| 应付职工薪酬-公积金（单位部分） | ①③ | cFund（全员）[③借] | cFund（全员）[①贷] |
| 其他应收款-社保（个人部分） | ①② | wSocial（全员）[②借] | wSocial（全员）[①贷] |
| 其他应收款-公积金（个人部分） | ①③ | wFund（全员）[③借] | wFund（全员）[①贷] |
| 应交税费-应交个人所得税 | ①④ | tax（全员）[④借] | tax（全员）[①贷] |
| 银行存款 | ②③④⑤ | — | 社保+公积金+个税+实发 |
| 营业外收入-违纪扣款 | ⑤ | — | absentDeduct（全员） |

---

## 8.「应付职工薪酬-人员工资」科目余额校验

5 张凭证全部完成后，该科目余额应为 0：

```
贷方（计提①）：  + fullGrossPay
借方（代扣①）：  - (wSocial + wFund + tax)
借方（发放⑤）：  - netPay
借方（缺勤⑤）：  - absentDeduct

余额 = fullGrossPay - (wSocial + wFund + tax) - netPay - absentDeduct

又因为：
  netPay = grossPay - (wSocial + wFund + tax)
  grossPay = fullGrossPay - absentDeduct

代入得：
余额 = fullGrossPay - (wSocial + wFund + tax)
       - (fullGrossPay - absentDeduct - wSocial - wFund - tax)
       - absentDeduct
       = 0 ✓
```

---

## 9. 阶段状态（2026-02-14）

- 状态：待开发（P3）。
- 前置依赖：`05-mod-payroll.md` 中的汇总与明细结果必须先稳定交付。
- P3 首批必须落地：
  - `voucherGenerator.ts` + `voucherGenerator.test.ts`
  - `aggregator.ts` + `aggregator.test.ts`
  - `VoucherPage` + `voucher-flow.spec.ts`
